* Interface tweaks
** alight commands
   #+BEGIN_SRC emacs-lisp
     (add-hook 'align-load-hook #'(lambda ()
				    (add-to-list 'align-rules-list
						 '(text-column-whitespace
						   (regexp  . "\\(^\\|\\S-\\)\\([ \t]+\\)")
						   (group   . 2)
						   (modes   . align-text-modes)
						   (repeat  . t)))))
   #+END_SRC

   #+RESULTS:


** set font
   - Install Monaco font in Ubuntu:
     - check [[https://github.com/cstrap/monaco-font][How To]].
     - ~./install-font-ubuntu.sh http://www.gringod.com/wp-upload/software/Fonts/Monaco_Linux.ttf~
     - ~./install-font-ubuntu.sh http://www.gringod.com/wp-upload/software/Fonts/Monaco_Linux.ttf~
     - ~mkdir ~/.fonts~
     - ~cp Monaco_Linux.ttf ~/.fonts/~
   #+begin_src emacs-lisp
     ;; to adjust font dynamically
     ;; C-xC-+ and C-xC-- to increase or decrease the buffer text size
     (cond
      ((string-equal system-type "windows-nt")
       (set-default-font "Consolas 10"))
      ((string-equal system-type "gnu/linux")
       (set-default-font "Monaco 10")))
   #+end_src

   #+RESULTS:

** set global key-bindings
   Use "C-h k" to check the meaning of command for which the current key-binding belongs to in current mode.
   #+begin_src emacs-lisp
     ;; use cmd + n and cmd + p to select next and previous lines
     (global-set-key (kbd "s-n") (kbd "C-S-n"))
     (global-set-key (kbd "s-p") (kbd "C-S-p"))
     ;; use c-z to undo
     (global-set-key (kbd "C-z") #'undo)

     ;; do code comment 
     (global-set-key (kbd "C-/") 'comment-or-uncomment-region)

     ;; use c-c c-c to execute a lisp function
     (global-set-key (kbd "C-c C-c") 'eval-last-sexp)

     ;; use f3 to use org-edit-special
     (global-set-key (kbd "<f3>") (kbd "C-c '"))
     ;; use f10 to format whole buffer
     (global-set-key (kbd "<f10>") (progn
				     #'mark-whole-buffer
				     #'indent-region))
     ;; use f5 to revert the buffer
     (global-set-key (kbd "<f5>") 'revert-buffer)
   #+end_src

   #+RESULTS:
   : 

** set buffer and shell
   #+begin_src emacs-lisp
     ;; no need for prompt for confirm when execute code block in org-mode
     (setq org-confirm-babel-evaluate nil)

     ;; make sure environment variables inside Emacs look the same as in the user's shell
     (use-package exec-path-from-shell
       :ensure t
       :config
       (progn
         (when (memq window-system '(mac ns x))
           (exec-path-from-shell-initialize))))
   #+end_src

   #+RESULTS:
   : t

** set line number
   #+BEGIN_SRC emacs-lisp
     (use-package nlinum
       :ensure t
       :config
       (progn
	 (global-nlinum-mode t)
	 ;; Preset `nlinum-format' for minimum width.
	 (defun my-nlinum-mode-hook ()
	   (when nlinum-mode
	     (setq-local nlinum-format
			 (concat "%" (number-to-string
				      ;; Guesstimate number of buffer lines.
				      (ceiling (log (max 1 (/ (buffer-size) 80)) 10)))
				 "d"))))
	 (add-hook 'nlinum-mode-hook #'my-nlinum-mode-hook)

	 ;; [[https://www.emacswiki.org/emacs/LineNumbers][solve bug with emacs daemon mode]]
	 (defun initialize-nlinum (&optional frame)
	   (require 'nlinum)
	   (add-hook 'prog-mode-hook 'nlinum-mode))
	 (when (daemonp)
	   (add-hook 'window-setup-hook 'initialize-nlinum)
	   (defadvice make-frame (around toggle-nlinum-mode compile activate)
	     (nlinum-mode -1) ad-do-it (nlinum-mode 1)))))
   #+END_SRC

   #+RESULTS:
   : t

** use y-or-n 
   #+begin_src emacs-lisp
     (fset 'yes-or-no-p 'y-or-n-p)

   #+end_src

   #+RESULTS:
   : y-or-n-p

** set adaptive-wrap
   #+BEGIN_SRC emacs-lisp
     (use-package adaptive-wrap
       :ensure t
       :config
       (progn
	 ;; (setq-default adaptive-wrap-extra-indent 2)
	 (add-hook 'visual-line-mode-hook #'adaptive-wrap-prefix-mode)
	 (global-visual-line-mode 1)))
   #+END_SRC

   #+RESULTS:
   : t

** change the cursor type and color
   #+begin_src emacs-lisp
     ;;(setq-default cursor-type '(hbar . 2))
     (setq-default cursor-type '(bar . 2))
   #+end_src

   #+RESULTS:


** highlight current line
   #+begin_src emacs-lisp
     (global-hl-line-mode +1)
   #+end_src 

   #+RESULTS:
   : t

** use indent-guide
   #+begin_src emacs-lisp
     (use-package indent-guide
       :ensure t
       :config
       (progn
         (indent-guide-global-mode)))
   #+end_src 

   #+RESULTS:
   : t

** highlight-indentation
   #+BEGIN_SRC emacs-lisp
     (use-package highlight-indentation
       :ensure t
       :config
       (progn
         (setq highlight-indentation-blank-lines t)
         (add-hook 'yaml-mode-hook #'highlight-indentation-mode)))
   #+END_SRC

   #+RESULTS:
   : t

** which-key
   #+begin_src emacs-lisp
     (use-package which-key
       :defer 2
       :ensure t
       :config (which-key-mode))
   #+end_src

** try
   #+begin_src emacs-lisp
     (use-package try
       :defer 2
       :ensure t)
   #+end_src

* Swiper/Ivy/Counsel
  Swiper gives us a really efficient incremental search with regular expressions and Ivy / Counsel replace a lot of ido or helms completion functionality
  #+begin_src emacs-lisp
    ;; it looks like counsel is a requirement for swiper
    (use-package counsel
      :defer 1
      :ensure t
      :bind
      (("M-y" . counsel-yank-pop)
       :map ivy-minibuffer-map
       ("M-y" . ivy-next-line)))

    (use-package ivy
      :defer 1
      :ensure t
      :diminish (ivy-mode)
      :bind (("C-x b" . ivy-switch-buffer))
      :config
      (ivy-mode 1)
      (setq ivy-use-virtual-buffers t)
      (setq ivy-count-format "%d/%d ")
      (setq ivy-display-style 'fancy))


    (use-package swiper
      :defer 1
      :ensure try
      :bind (("C-s" . swiper)
	     ("C-r" . swiper)
	     ("C-c C-r" . ivy-resume)
	     ("M-x" . counsel-M-x)
	     ("C-x C-f" . counsel-find-file))
      :config
      (progn
	(ivy-mode 1)
	(setq ivy-use-virtual-buffers t)
	(setq ivy-display-style 'fancy)
	(define-key read-expression-map (kbd "C-r") 'counsel-expression-history)))
  #+end_src
  
* Keep parentheses balanced
** Paredit
   #+begin_src emacs-lisp
     (use-package paredit
       :defer 1
       :ensure t
       :init
       (progn
	 (autoload 'enable-paredit-mode "paredit" "Turn on pseudo-structural editing of Lisp code." t)
	 (add-hook 'emacs-lisp-mode-hook       #'enable-paredit-mode)
	 (add-hook 'eval-expression-minibuffer-setup-hook #'enable-paredit-mode)
	 (add-hook 'ielm-mode-hook             #'enable-paredit-mode)
	 ;; (add-hook 'lisp-mode-hook             #'enable-paredit-mode)
	 (add-hook 'sly-mode-hook             #'enable-paredit-mode)
	 (add-hook 'lisp-interaction-mode-hook #'enable-paredit-mode)
	 (add-hook 'scheme-mode-hook           #'enable-paredit-mode)
	 (add-hook 'racket-mode-hook           #'enable-paredit-mode)

	 ;; paredit with eldoc
	 (require 'eldoc) ; if not already loaded
	 (eldoc-add-command
	  'paredit-backward-delete
	  'paredit-close-round)

	 ;; paredit with electric return
	 (defvar electrify-return-match
	   "[\]}\)\"]"
	   "If this regexp matches the text after the cursor, do an \"electric\"
       return.")
	 (defun electrify-return-if-match (arg)
	   "If the text after the cursor matches `electrify-return-match' then
       open and indent an empty line between the cursor and the text.  Move the
       cursor to the new line."
	   (interactive "P")
	   (let ((case-fold-search nil))
	     (if (looking-at electrify-return-match)
		 (save-excursion (newline-and-indent)))
	     (newline arg)
	     (indent-according-to-mode)))
	 ;; Using local-set-key in a mode-hook is a better idea.
	 (global-set-key (kbd "RET") 'electrify-return-if-match)))
   #+end_src
** complements to paredit
   #+begin_src emacs-lisp
     ;; Show matching arenthesis
     (show-paren-mode 1)
     (setq show-paren-delay 0)

     (require 'paren)
     (set-face-background 'show-paren-match (face-background 'default))
   #+end_src

   #+RESULTS:


** smartparens
   [[https://github.com/Fuco1/smartparens][smartparens]] is an excellent (newer) alternative to paredit. Many Clojure hackers have adopted it recently and you might want to give it a try as well.
   #+BEGIN_SRC emacs-lisp
     (use-package smartparens
       :ensure t
       :config
       (progn
	 (add-hook 'js-mode-hook #'smartparens-mode)
	 (add-hook 'typescript-mode-hook #'smartparens)
	 (add-hook 'c-mode-hook #'smartparens-mode)
	 (add-hook 'c++-mode-hook #'smartparens-mode)
	 (add-hook 'web-mode-hook #'smartparens-mode)))
   #+END_SRC

   #+RESULTS:
   : t

* Helm
  #+BEGIN_SRC emacs-lisp
    (use-package helm
      :ensure t
      :config
      (progn
	;; The default "C-x c" is quite close to "C-x C-c", which quits Emacs.
	;; Changed to "C-c h". Note: We must set "C-c h" globally, because we
	;; cannot change `helm-command-prefix-key' once `helm-config' is loaded.
	(global-set-key (kbd "C-c h") 'helm-command-prefix)
	(global-unset-key (kbd "C-x c"))

	;; C-x C-f runs the command counsel-find-file
	(global-unset-key (kbd "C-x C-f"))
	(global-set-key (kbd "C-x C-f") #'helm-find-files)

	(define-key helm-map (kbd "<tab>") 'helm-execute-persistent-action) ; rebind tab to run persistent action
	(define-key helm-map (kbd "C-i") 'helm-execute-persistent-action) ; make TAB work in terminal
	(define-key helm-map (kbd "C-z")  'helm-select-action) ; list actions using C-z

	(when (executable-find "curl")
	  (setq helm-google-suggest-use-curl-p t))

	(setq helm-split-window-in-side-p           t ; open helm buffer inside current window, not occupy whole other window
	      helm-move-to-line-cycle-in-source     t ; move to end or beginning of source when reaching top or bottom of source.
	      helm-ff-search-library-in-sexp        t ; search for library in `require' and `declare-function' sexp.
	      helm-scroll-amount                    8 ; scroll 8 lines other window using M-<next>/M-<prior>
	      helm-ff-file-name-history-use-recentf t
	      helm-echo-input-in-header-line t

	      ;; optional fuzzy matching for helm-M-x
	      helm-M-x-fuzzy-match t
	      helm-buffers-fuzzy-matching t
	      helm-recentf-fuzzy-match t

	      ;; TOOD: helm-semantic has not syntax coloring! How can I fix that?
	      helm-semantic-fuzzy-match t
	      helm-imenu-fuzzy-match t)

	(defun spacemacs//helm-hide-minibuffer-maybe ()
	  "Hide minibuffer in Helm session if we use the header line as input field."
	  (when (with-helm-buffer helm-echo-input-in-header-line)
	    (let ((ov (make-overlay (point-min) (point-max) nil nil t)))
	      (overlay-put ov 'window (selected-window))
	      (overlay-put ov 'face
			   (let ((bg-color (face-background 'default nil)))
			     `(:background ,bg-color :foreground ,bg-color)))
	      (setq-local cursor-type nil))))


	(add-hook 'helm-minibuffer-set-up-hook
		  'spacemacs//helm-hide-minibuffer-maybe)

	(setq helm-autoresize-max-height 0)
	(setq helm-autoresize-min-height 20)
	(helm-autoresize-mode 1)
	(helm-mode 1)))
  #+END_SRC

  #+RESULTS:
  : t
* Projectile
  #+begin_src emacs-lisp
    (use-package projectile
      :ensure t
      :bind ("C-c p" . projectile-command-map)
      :config
      (progn
	(projectile-global-mode)
	(setq projectile-completion-system 'helm)

	(use-package helm-projectile
	  :ensure t
	  :config
	  (helm-projectile-on))))
  #+end_src

  #+RESULTS:
  : projectile-command-map

* Company
  #+BEGIN_SRC emacs-lisp
    (use-package company
      :defer t
      :ensure t
      :config
      (progn
	(add-hook 'after-init-hook 'global-company-mode)

	(setq completion-ignore-case t)
	(setq company-dabbrev-downcase nil)
	;; Show suggestions after entering one character.
	(setq company-minimum-prefix-length 1)
	;; wrap around to the top of the list again
	(setq company-selection-wrap-around t)
	(setq company-echo-delay 0)
	(setq company-idle-delay 0.2)

	(define-key company-active-map [tab] 'company-complete-selection)
	;; (define-key company-active-map (kbd "<tab>") 'company-complete-selection)
	(define-key company-active-map (kbd "C-n") 'company-select-next)
	(define-key company-active-map (kbd "C-p") 'company-select-previous)


	;; set default `company-backends'
	(defvar company-general-backends '((company-files ; files & directory
					    company-keywords ; keywords
					    company-capf
					    company-dabbrev
					    company-yasnippet)
					   (company-abbrev company-dabbrev)))
	(setq company-backends company-general-backends)

	(defmacro add-to-company-backends (company-xxx-names &optional at)
	  "company-xxx-names: '(company-ycmd company-foo)"
	  `(let ((p (or ,at "front")))
	     (cond 
	      ((string-equal p "end")
	       (mapc #'(lambda (n)
			 (append (car company-backends) (list n)))
		     ,company-xxx-names))
	      (t
	       (mapc #'(lambda (n)
			 (setq company-backends
			       (cons (cons n 
					   (car company-backends)) 
				     (cdr company-backends))))
		     ,company-xxx-names)))
	     (setq company-backends (cons (remove-duplicates (car company-backends) :test 'eq) (cdr company-backends)))))

	;; use statistics to better filter completion candidates
	(use-package company-statistics
	  :ensure t
	  :config
	  (progn
	    (add-hook 'company-mode-hook #'company-statistics-mode)
	    (setq company-transformers '(company-sort-by-statistics
					 company-sort-by-backend-importance))))

	;; (use-package company-posframe
	;;   :ensure t
	;;   :config
	;;   (progn
	;; 	(add-hook 'company-mode #'company-posframe-mode)))

	(use-package company-quickhelp
	  :ensure t
	  :config
	  (progn
	    (setq company-quickhelp-delay 1.0)
	    (add-hook 'company-mode #'company-quickhelp-mode)))))
  #+END_SRC

  #+RESULTS:
  : t

* Rainbow-delimiters
  #+BEGIN_SRC emacs-lisp
    (use-package rainbow-delimiters
      :ensure t
      :config
      (progn
        ;; (add-hook 'lisp-mode-hook #'rainbow-delimiters-mode)
        (add-hook 'sly-mode-hook #'rainbow-delimiters-mode)
        (add-hook 'emacs-lisp-mode-hook #'rainbow-delimiters-mode)))
  #+END_SRC

  #+RESULTS:
  : t

* Ace-window
  #+begin_src emacs-lisp
    (use-package ace-window
      :defer 2
      :ensure t
      :init
      :config
      (progn
	(setq aw-scope 'frame)
	(global-set-key (kbd "C-x O") 'other-frame)
	(global-set-key [remap other-window] 'ace-window)
	(custom-set-faces
	 '(aw-leading-char-face
	   ((t (:inherit ace-jump-face-foreground :height 3.0)))))))
  #+end_src

  #+RESULTS:
  : t

* Set emacs theme
  #+begin_src emacs-lisp
    ;; leuven-theme
    ;; gruvbox-theme
    ;; material-theme
    ;; flucui-themes
    ;; solarized-theme

    (use-package solarized-theme
      :ensure t
      :config
      (progn
	(load-theme 'solarized-dark t)
	(set-face-attribute 'show-paren-match nil :weight 'extra-bold)))
  #+end_src

  #+RESULTS:
  : t

* Org mode enhancement
** common settings
   #+BEGIN_SRC emacs-lisp
     (use-package org-plus-contrib
       :ensure t
       :config
       (progn
         (require 'org-eldoc)
         (require 'org-tempo)))

     (add-hook 'org-mode-hook #'(lambda ()
                                  (progn
                                    ;; all languages needed to be confirmed to execute except emacs-lisp and lisp
                                    (defun my-org-confirm-babel-evaluate (lang body)
                                      (not (member lang '("emacs-lisp" "lisp"))))
                                    (setq org-confirm-babel-evaluate 'my-org-confirm-babel-evaluate))))

     ;; To bind a key in a mode, you need to wait for the mode to be loaded before defining the key.
     (eval-after-load 'org
       #'(lambda ()
           (define-key org-mode-map [f9] #'org-global-cycle)
           (define-key org-mode-map [f6] #'org-toggle-inline-images)))
   #+END_SRC

   #+RESULTS:
   : org-toggle-inline-images


** make code-block could be executed in org-mode
   If you find Org-Mode Evaluation of code is disabled, do:
   =find ~/.emacs.d/elpa/org* -name "*elc" -delete=

   #+begin_src emacs-lisp
     ;; evaluation use sly instead of using slime, need to use org-plus-contrib
     (setq org-babel-lisp-eval-fn #'sly-eval)

     (require 'org-tempo)
     (add-to-list 'org-structure-template-alist '("el" . "src emacs-lisp"))
     (add-to-list 'org-structure-template-alist '("lisp" . "src lisp"))
     (add-to-list 'org-structure-template-alist '("sh" . "src sh"))

     (cond
      ((string-equal system-type "darwin")
       (progn
	 (org-babel-do-load-languages
	  'org-babel-load-languages
	  '((shell . t)
	    (lisp . t)
	    (C . t)))))
      ;; the shell configuration for Linux could either be sh or shell 
      ;; it is not same in different Linux system.
      ((string-equal system-type "gnu/linux")
       (progn
	 (org-babel-do-load-languages
	  'org-babel-load-languages
	  '((C . t)
	    (lisp . t)))))
      ((string-equal system-type "windows-nt")
       (progn
	 (org-babel-do-load-languages
	  'org-babel-load-languages
	  '((shell . t)
	    (lisp . t)
	    (C . t))))))



   #+end_src
   
   #+RESULTS:


** htmlize --- convert buffer text and decorations to HTML
   #+BEGIN_SRC emacs-lisp
     (use-package htmlize
       :defer 2
       :ensure t)
   #+END_SRC

   #+RESULTS:
   : [nil 0 2 0 nil require (htmlize nil t) idle 0]
   m
* Treemacs
  #+begin_src emacs-lisp
    (use-package treemacs
      :defer t
      :ensure t
      :defer t
      :init
      (progn
	(use-package lv
	  :ensure t)
	(use-package hydra
	  :ensure t)
	(with-eval-after-load 'winum
	  (define-key winum-keymap (kbd "M-0") #'treemacs-select-window)))
      :config
      (progn
	;; (pcase (cons (not (null (executable-find "git")))
	;;              (not (null (executable-find "python3"))))
	;;   (`(t . t)
	;;    (treemacs-git-mode 'deferred))
	;;   (`(t . _)
	;;    (treemacs-git-mode 'simple)))
	(setq treemacs-collapse-dirs              (if (executable-find "python") 3 0)
	      treemacs-file-event-delay           5000
	      treemacs-follow-after-init          t
	      treemacs-follow-recenter-distance   0.1
	      treemacs-goto-tag-strategy          'refetch-index
	      treemacs-indentation                1
	      ;; indent guide
	      treemacs-indentation-string (propertize " | " 'face 'font-lock-comment-face)
	      ;; treemacs-indentation-string         "|"
	      treemacs-is-never-other-window      nil
	      treemacs-no-png-images              nil
	      treemacs-project-follow-cleanup     nil
	      treemacs-recenter-after-file-follow nil
	      treemacs-recenter-after-tag-follow  nil
	      treemacs-show-hidden-files          t
	      treemacs-silent-filewatch           nil
	      treemacs-silent-refresh             nil
	      treemacs-sorting                    'alphabetic-desc
	      treemacs-tag-follow-cleanup         t
	      treemacs-tag-follow-delay           1.5
	      treemacs-width                      40
	      treemacs-follow-mode                t
	      treemacs-filewatch-mode             t
	      treemacs-git-mode nil))
      :bind
      (:map global-map
	    ([f8]        . treemacs)
	    ("M-0"       . treemacs-select-window)
	    ("C-x t 1"   . treemacs-delete-other-windows)
	    ("C-x t t"   . treemacs)
	    ("C-x t B"   . treemacs-bookmark)
	    ("C-x t C-t" . treemacs-find-file)
	    ("C-x t M-t" . treemacs-find-tag)))

    (use-package treemacs-evil
      :defer t
      :after treemacs evil
      :ensure t)

    (use-package treemacs-projectile
      :defer t
      :after treemacs projectile
      :ensure t)

    (use-package treemacs-icons-dired
      :defer t
      :after treemacs dired
      :ensure t
      :config (treemacs-icons-dired-mode))


  #+end_src

  #+RESULTS:

* Markdown 
  - sudo apt install pandoc
  #+BEGIN_SRC emacs-lisp
    (use-package markdown-mode
      :ensure t
      :commands (markdown-mode gfm-mode)
      :mode (("README\\.md\\'" . gfm-mode)
             ("\\.md\\'" . markdown-mode)
             ("\\.markdown\\'" . markdown-mode))
      :init (setq markdown-command "multimarkdown")
      :config
      (progn
        (setq markdown-command "/usr/bin/pandoc")))
  #+END_SRC

  #+RESULTS:

* Magit
  #+begin_src emacs-lisp
    (use-package magit
      :ensure t)
  #+end_src

  #+RESULTS:

* Programming
** Common features
*** Flycheck
    #+BEGIN_SRC emacs-lisp
    (use-package flycheck
      :defer 2
      :ensure t)

    (use-package flycheck-yamllint
      :defer t
      :ensure t
      :init
      (progn
	(eval-after-load 'flycheck
	  '(add-hook 'flycheck-mode-hook 'flycheck-yamllint-setup))))

    #+END_SRC

    #+RESULTS:
    | flycheck-yamllint-setup | flycheck-mode-set-explicitly |

*** Lsp
    [[https://github.com/emacs-lsp/lsp-mode][see lsp-mode]]
    #+begin_src emacs-lisp
      (use-package lsp-mode
	:init
	(require 'lsp-clients)
	:ensure t
	:config
	(progn
	  (setq lsp-message-project-root-warning t)

	  ;; change nil to 't to enable logging of packets between emacs and the LS
	  ;; this was invaluable for debugging communication with the MS Python Language Server
	  ;; and comparing this with what vs.code is doing
	  (setq lsp-print-io nil)

	  (use-package lsp-ui
	    :ensure t
	    :config
	    (progn
	      (define-key lsp-ui-mode-map [remap xref-find-definitions] #'lsp-ui-peek-find-definitions)
	      (define-key lsp-ui-mode-map [remap xref-find-references] #'lsp-ui-peek-find-references)
	      (setq lsp-ui-sideline-ignore-duplicate t)
	      (setq lsp-ui-imenu-enable t)
	      (add-hook 'lsp-mode-hook 'lsp-ui-mode)))

	  (use-package company-lsp
	    :ensure t
	    :config
	    (progn
	      (setq company-lsp-cache-candidates nil)
	      (setq company-lsp-async t)
	      (setq company-lsp-enable-recompletion t)))

	  ;; make multiple source to do completion even in lsp-mode
	  (defun reset-company-backends () 
	    (interactive)
	    (setq company-backends (cons (cons 'company-lsp (car company-general-backends)) (cdr company-general-backends))))
    
	  (defun my-setup-lsp ()
	    (lsp)
	    ;; set the completion backends after lsp called, since it will simply push company-lsp at the beginning of the company-backends
	    (reset-company-backends))

	  (use-package helm-lsp :commands helm-lsp-workspace-symbol)
	  (use-package lsp-treemacs :commands lsp-treemacs-errors-list)


	  (use-package dap-mode
	    :ensure t
	    :config
	    (progn
	      (dap-mode 1)
	      (dap-ui-mode 1)))))
    #+end_src

    #+RESULTS:
    : t

*** Clang format
    !!! Do not forget to install clang-format: =sudo apt install clang-format=.
    #+begin_src emacs-lisp
      (use-package clang-format
	:ensure t
	:config
	(progn
	  (defun clang-format-buffer-smart ()
	    "Reformat buffer if .clang-format exists in the projectile root."
	    (when (f-exists? (expand-file-name ".clang-format" (projectile-project-root)))
	      (clang-format-buffer)))

	  (dolist (each-hook '(c-mode-hook c++-mode-hook js-mode-hook))
	    (add-hook each-hook #'(lambda ()
				    (add-hook 'before-save-hook #'clang-format-buffer-smart nil 'local))))

	  ;; disable clang-format in json-mode
	  (use-package json-mode
	    :ensure t
	    :config
	    (progn
	      (add-hook 'json-mode-hook #'(lambda ()
					    (remove-hook 'before-save-hook #'clang-format-buffer-smart 'local)
					    (add-hook 'before-save-hook #'json-mode-beautify nil 'local)))))

	  (use-package yaml-mode
	    :ensure t
	    :config
	    (progn
	      (add-hook 'yaml-mode-hook #'(lambda ()
					    (remove-hook 'before-save-hook #'clang-format-buffer-smart 'local)
					    (add-hook 'before-save-hook #'newline-and-indent nil 'local)))))))


    #+end_src

    #+RESULTS:
    : t

*** yasnippet
    #+begin_src emacs-lisp
      (use-package yasnippet
	:ensure t
	:diminish yas-minor-mode
	:config (yas-global-mode t))
    #+end_src

    #+RESULTS:
    : t

*** Aggressive-indent-mode
    #+BEGIN_SRC emacs-lisp
      (use-package aggressive-indent
	:ensure t
	:config
	(progn
	  ;; active it for specific mode
	  (add-hook 'emacs-lisp-mode-hook #'aggressive-indent-mode)
	  (add-hook 'scheme-mode-hook #'aggressive-indent-mode)
	  ;; deactive it for specific mode
	  (add-to-list 'aggressive-indent-excluded-modes 'html-mode)))
    #+END_SRC

    #+RESULTS:
    : t

*** expand-region
    #+begin_src emacs-lisp
      (use-package expand-region
	:ensure t
	:config
	(progn
	  (global-set-key (kbd "C-=") 'er/expand-region)
	  (global-set-key (kbd "C--") 'er/contract-region)))
    #+end_src

    #+RESULTS:
    : t

** Lisp programming configuration
*** lispy
    #+begin_src emacs-lisp
      (use-package lispy
	:ensure t
	:config
	(progn
	  (add-hook 'emacs-lisp-mode-hook (lambda () (lispy-mode 1)))
	  (add-hook 'lisp-mode-hook (lambda () (lispy-mode 1)))))
    #+end_src
*** Eldoc to show argument list
    #+begin_src emacs-lisp
      (use-package eldoc
	:defer t
	:ensure t
	:init
	:config
	(progn
	  (add-hook 'emacs-lisp-mode-hook 'turn-on-eldoc-mode)
	  (add-hook 'lisp-interaction-mode-hook 'turn-on-eldoc-mode)
	  (add-hook 'ielm-mode-hook 'turn-on-eldoc-mode)
	  ;; highlight eldoc arguments in emacslisp
	  (defun eldoc-get-arg-index ()
	    (save-excursion
	      (let ((fn (eldoc-fnsym-in-current-sexp))
		    (i 0))
		(unless (memq (char-syntax (char-before)) '(32 39)) ; ? , ?'
		  (condition-case err
		      (backward-sexp)             ;for safety
		    (error 1)))
		(condition-case err
		    (while (not (equal fn (eldoc-current-symbol)))
		      (setq i (1+ i))
		      (backward-sexp))
		  (error 1))
		(max 0 i))))

	  (defun eldoc-highlight-nth-arg (doc n)
	    (cond ((null doc) "")
		  ((<= n 0) doc)
		  (t
		   (let ((i 0))
		     (mapconcat
		      (lambda (arg)
			(if (member arg '("&optional" "&rest"))
			    arg
			  (prog2
			      (if (= i n)
				  (put-text-property 0 (length arg) 'face 'underline arg))
			      arg
			    (setq i (1+ i)))))
		      (split-string doc) " ")))))

	  (defadvice eldoc-get-fnsym-args-string (around highlight activate)
	    ""
	    (setq ad-return-value (eldoc-highlight-nth-arg ad-do-it
							   (eldoc-get-arg-index))))))
    #+end_src

    #+RESULTS:
    : t

*** Common-lisp
    #+begin_src emacs-lisp
      (use-package sly
	:ensure t
	:config
	(progn
	  (setq sly-lisp-implementations
		'((sbcl ("/usr/local/bin/sbcl") :coding-system utf-8-unix)
		  ))
	  ;; (setq inferior-lisp-program "clisp"
	  ;; 	  exec-path (append exec-path
	  ;;                         '("/usr/local/bin")))
	  ))

    #+end_src

    #+RESULTS:
    : t

*** Racket
    #+begin_src emacs-lisp
      (use-package racket-mode
	:mode "\\.racket\\'"
	:ensure t
	:config
	(progn
	  (if (string-equal system-type "windows-nt")
	      (setq racket-program "c:/Program Files/Racket/Racket.exe")
	    (setq racket-program "/Applications/Racket_v7.0/bin/racket"))
	  (add-hook 'racket-mode-hook
		    (lambda ()
		      (define-key racket-mode-map (kbd "C-c r") 'racket-run)))
	  (setq tab-always-indent 'complete)
	  (add-hook 'racket-mode-hook      #'racket-unicode-input-method-enable)
	  (add-hook 'racket-repl-mode-hook #'racket-unicode-input-method-enable)

	  ;; setup file ending in ".scheme" to open in racket-mode 
	  (add-to-list 'auto-mode-alist '("\\.scheme\\'" . racket-mode))))
    #+end_src

    #+RESULTS:
    : t

*** Scheme
    #+begin_src emacs-lisp
      (use-package geiser
	:ensure t
	:config
	(progn
	  (add-hook 'scheme-mode-hook #'geiser-mode--maybe-activate)
	  (setq geiser-active-implementations '(guile))
	  (setq geiser-mode-start-repl-p t)))

    #+end_src
** Scala programming
*** ensime
    #+begin_src emacs-lisp
      (use-package ensime
	:mode "\\.scala\\'"
	:init 
	(if (string-equal system-type "windows-nt")
	    (progn
	      (setq exec-path (append exec-path '("c:/Program Files (x86)/scala/bin")))
	      (setq exec-path (append exec-path '("c:/Program Files (x86)/sbt/bin"))))
	  (setq exec-path (append exec-path '("/usr/local/bin"))))
	:ensure t
	:config
	(progn
	  ;; (add-hook 'scala-mode-hook 'ensime-scala-mode-hook)
	  (add-hook 'scala-mode-hook 'ensime-mode)))
    #+end_src

    #+RESULTS:
    : t
    
** Python development
*** with lsp 
    - References
      - [[https://vxlabs.com/2018/11/19/configuring-emacs-lsp-mode-and-microsofts-visual-studio-code-python-language-server/][Configuring Emacs, lsp-mode and Microsoft's Visual Studio Code Python language server.]] (using)
    - Components
      - server: Microsoft Python Language Server
      - client: lsp-python-ms
      - installation
	- install [[https://dotnet.microsoft.com/download][dotnet-sdk]]
	  - [[https://dotnet.microsoft.com/download/linux-package-manager/ubuntu18-04/sdk-current][installation on ubuntu18.04]]
	- clone and install [[https://github.com/Microsoft/python-language-server][python-language-server]]
    - Configuration with emacs
      #+begin_src emacs-lisp

	(use-package lsp-python-ms
	  :ensure t
	  :config
	  (progn
	    ;; for dev build of language server
	    (setq lsp-python-ms-dir
		  (expand-file-name "~/python-language-server/output/bin/Release/"))

	    (setq python-shell-interpreter "python3")
	    (add-hook 'python-mode-hook #'my-setup-lsp)
	    (add-hook 'python-mode-hook #'smartparens-mode)))

      #+end_src

      #+RESULTS:
      : t


   
*** Debugging
    Debugg using pdb
    #+BEGIN_SRC python
      # import ipd
      # ipdb.set_trace ()
    #+END_SRC

*** Test Integration
    Configure your test Runner
    M-x elpy-set-test-runner
    C-c C-t  ;; runs test/ all tests


** Clojure programming
*** CIDER
    It is the Clojure(Script) Interactive Development Environment.
    #+BEGIN_SRC emacs-lisp
      (use-package cider
	:ensure t
	:config
	(progn
          (add-hook 'cider-repl-mode-hook #'enable-paredit-mode)
          (add-hook 'cider-repl-mode-hook #'subword-mode)
          (add-hook 'cider-repl-mode-hook #'rainbow-delimiters-mode)
          (use-package helm-cider
            :ensure t
            :config
            (progn
              (add-hook 'cider-repl-mode-hook #'helm-cider-mode)))))
    #+END_SRC

    #+RESULTS:
    : t
   
*** Clojure-mode
    #+BEGIN_SRC emacs-lisp
      (use-package clojure-mode
	:ensure t
	:config
	(progn
          (setq clojure-align-forms-automatically t)
          ;; make moving between characters faster
          (add-hook 'clojure-mode-hook #'subword-mode)
          ;; use paredit or smartparens 
          (add-hook 'clojure-mode-hook #'enable-paredit-mode)
          (add-hook 'clojure-mode-hook #'rainbow-delimiters-mode)
          (add-hook 'clojure-mode-hook #'aggressive-indent-mode)))

    #+END_SRC

    #+RESULTS:
    : t

   
*** Userful key-bindings in Clojure programming
    - C-c C-d C-d will display documentation for the symbol under point, which can be a huge time-saver.
    - M-. will navigate to the source code for the symbol under point
    - M-, will return you to your original buffer and position
    - C-c C-d C-a lets you search for arbitrary text across function names and documentation
    - For paredit
      - M-( Surround expression after point in parentheses (paredit-wrap-round).
      - C-<left or right arrow>, surp or barf
      - C-M-f, C-M-b Move to the opening/closing parenthesis.

** C/C++ programming
*** with lsp
    - Components
      - install clang: =sudo apt install clang=
      - install clangd: [[https://clang.llvm.org/extra/clangd/Installation.html#installing-clangd][Getting started with clangd]]
      - Configuration with emacs
	#+begin_src emacs-lisp
	  (add-hook 'c-mode-hook #'my-setup-lsp)
	  (add-hook 'c++-mode-hook #'my-setup-lsp)
	#+end_src

*** CMakeLists
    #+begin_src emacs-lisp
      (use-package cmake-mode
	:ensure t
	:config
	(progn
	  (add-hook 'cmake-mode-hook #'(lambda ()
					 (smartparens-mode +1)))))
    #+end_src

    #+RESULTS:
    : t

** Javascript and typescript
*** interface
    #+begin_src emacs-lisp
      (setq js-indent-level 2)
      (setq typescript-indent-level 2)
    #+end_src

    #+RESULTS:
    : 2

*** with lsp
    - =sudo npm i -g javascript-typescript-langserver=
    - =sudo npm install -g typescript-language-server typescript=
    - emacs configuration
      #+begin_src emacs-lisp
	(add-hook 'js-mode-hook #'my-setup-lsp)
	(add-hook 'typescript-mode-hook #'my-setup-lsp)
      #+end_src

      #+RESULTS:
      | (lambda nil (require (quote dap-chrome)) (require (quote dap-node))) | lsp | er/add-js-mode-expansions | (lambda nil (add-hook (quote before-save-hook) (function clang-format-buffer-smart) nil (quote local))) | smartparens-mode |

*** with dap
    #+begin_src emacs-lisp
      (add-hook 'js-mode-hook #'(lambda ()
				  (require 'dap-chrome)
				  (require 'dap-node)))
    #+end_src

    #+RESULTS:
    | (lambda nil (require (quote dap-chrome)) (require (quote dap-node))) | lsp | er/add-js-mode-expansions | (lambda nil (add-hook (quote before-save-hook) (function clang-format-buffer-smart) nil (quote local))) | smartparens-mode |

** web programming
   - For Vue.js
     - =npm install -g vue-language-server=
     - =npm install -g vue=
   - Configuration
   #+BEGIN_SRC emacs-lisp
     (use-package web-mode
       :mode (("\\.html$" . web-mode)
	      ("\\.djhtml$" . web-mode)
	      ("\\.tsx$" . web-mode)
	      ("\\.mustache\\'" . web-mode)
	      ("\\.phtml\\'" . web-mode)
	      ("\\.as[cp]x\\'" . web-mode)
	      ("\\.erb\\'" . web-mode)
	      ("\\.hbs\\'" . web-mode)
	      ("\\.vue$" . web-mode))
       :config
       (progn
	 (defun lsp-html-setup ()
	   "Function to setup `lsp-html'"
	   (my-setup-lsp)
	   (reset-company-backends)
	   (setq-local lsp-highlight-symbol-at-point nil)
	   (bind-key "C-c o b" #'browse-url-of-file (current-local-map)))

	 (defun lsp-vue-setup ()
	   (my-setup-lsp)
	   (reset-company-backends))

	 ;; (with-eval-after-load "smartparens"
	 ;;   (defun +web-is-auto-close-style-3 (_id action _context)
	 ;; 	(and (eq action 'insert)
	 ;; 	     (eq web-mode-auto-close-style 3)))
	 ;;   (sp-local-pair 'web-mode "<" nil :unless '(:add +web-is-auto-close-style-3))

	 ;;   ;; let smartparens handle these
	 ;;   (setq web-mode-enable-auto-quoting nil
	 ;; 	    web-mode-enable-auto-pairing t)

	 ;;   ;; 1. Remove web-mode auto pairs whose end pair starts with a latter
	 ;;   ;;    (truncated autopairs like <?p and hp ?>). Smartparens handles these
	 ;;   ;;    better.
	 ;;   ;; 2. Strips out extra closing pairs to prevent redundant characters
	 ;;   ;;    inserted by smartparens.
	 ;;   (dolist (alist web-mode-engines-auto-pairs)
	 ;; 	(setcdr alist
	 ;; 		(cl-loop for pair in (cdr alist)
	 ;; 			 unless (string-match-p "^[a-z-]" (cdr pair))
	 ;; 			 collect (cons (car pair)
	 ;; 				       (string-trim-right (cdr pair) "\\(?:>\\|]\\|}\\)+")))))
	 ;;   (setf (alist-get nil web-mode-engines-auto-pairs) nil))


	 (setq web-mode-markup-indent-offset 2)
	 (setq web-mode-css-indent-offset 2)
	 (setq web-mode-code-indent-offset 2)
	 (setq web-mode-enable-html-entities-fontification t
	       web-mode-auto-close-style 2)

	 ;; highlight matching tag
	 (setq web-mode-enable-current-element-highlight t)
	 ;; colorize colors in buffers
	 (setq web-mode-enable-css-colorization t)

	 ;; impatient mode: Live refresh of web pages
	 ;; https://github.com/skeeto/impatient-mode
	 (use-package impatient-mode
	   :commands (impatient-mode))

	 (add-hook 'web-mode-hook #'(lambda ()
				      (progn
					(pcase (file-name-extension buffer-file-name) ("html" (lsp-html-setup)))
					;; (pcase (file-name-extension buffer-file-name) ("vue" (lsp-vue-setup)))
					(add-hook 'before-save-hook #'clang-format-buffer-smart nil 'local))))))
   #+END_SRC


** Java programming
   [[http://www.goldsborough.me/emacs,/java/2016/02/24/22-54-16-setting_up_emacs_for_java_development/][blog shows how to setup emacs for java development]]

** R programming
   #+begin_src emacs-lisp
     (use-package ess
       :ensure t
       :init
       ;;  :init (require 'ess-site)
       :config
       (progn
	 (setq inferior-R-program-name "/usr/local/bin/R"
	       comint-input-ring-size 1000
	       ess-indent-level 4
	       ess-arg-function-offset 4
	       ess-else-offset 4
	       ess-continued-statement-offset 2);

	 (add-hook 'ess-mode-hook 
		   (lambda () 
		     (setq truncate-lines t)
		     (auto-fill-mode)))))
   #+end_src

   #+RESULTS:
   : t

* References
** Good general configurations
   - [[https://ladicle.com/post/config/][Ladicle's Emacs Configuration]]
   - [[https://pages.sachachua.com/.emacs.d/Sacha.html][Sacha Chua's Emacs configuration]]
   - [[https://github.com/CSRaghunandan/.emacs.d/tree/master/setup-files][a different way to organize configuration files]]
   - [[https://github.com/jerryhsieh/Emacs-config][jerryhsieh/Emacs-config]]
** C/C++ related
   - [[http://syamajala.github.io/c-ide.html][Emacs as C++ IDE]] 
   - [[http://martinsosic.com/development/emacs/2017/12/09/emacs-cpp-ide.html#configuration][Emacs as a C++ IDE]]
   - https://ddavis.io/
** Good Blogs related to emacs
   - [[http://blog.binchen.org/index.html][about many emacs articles]]
   - [[https://blog.onionstudio.com.tw/][洋蔥部落格]]

