* Create the Dockerfile
  #+begin_src dockerfile
    # Dockerfile for development with emacs
    FROM ubuntu:16.04

    # for ssh
    RUN apt-get update && apt-get install -y openssh-server
    # for network tools
    RUN apt-get install -y tcpdump telnet curl wget
    # for c/c++
    RUN apt-get install -y cmake gcc
    # for debug
    RUN apt-get install -y gdbserver valgrind
    # for git
    RUN apt-get install -y git
    # for nodejs
    RUN apt-get install -y nodejs npm
    # for emacs
    RUN add-apt-repository ppa:kelleyk/emacs
    RUN apt-get update
    RUN apt-get install -y emacs26

    RUN mkdir /var/run/sshd
    RUN echo 'root:gghh3344' | chpasswd
    RUN sed -i 's/PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config

    # SSH login fix. Otherwise user is kicked off after login
    RUN sed 's@session\s*required\s*pam_loginuid.so@session optional pam_loginuid.so@g' -i /etc/pam.d/sshd

    ENV NOTVISIBLE "in users profile"
    RUN echo "export VISIBLE=now" >> /etc/profile

    # port 22 will be used to ssh into the container
    # port 9999 could be used to connect to some application
    # port 7777 will be used to run gdbserver program that allows to debug the program remotely
    # docker run -d -p 3022:22 -p 7777:7777 -p 9999:9999 --security-opt seccomp:unconfined --name dev zwpdbh/emacs-dev:<tag_name>
    # Then try to ssh into the container 
    # ssh -p 3022 root@localhost
    # password will be "root"
    EXPOSE 22 9999 7777
    CMD ["/usr/sbin/sshd", "-D"]
  #+end_src
* Build docker image
  #+begin_src sh
    docker build -t emacs-dev .
  #+end_src

* Run a emacs-dev container
  #+begin_src sh
    docker run -d -P --name dev emacs-dev 
  #+end_src

* Check the mapped 22 port 
  #+begin_src sh
    docker port dev 22
  #+end_src

* Connect to mappped port founded from above (passwd is gghh3344)
  #+begin_src sh
    ssh root@localhost -p <mapped_port>
  #+end_src
* Commit to update image from current container state
  #+begin_src sh
    docker commit -m "->install emacs26" dev zwpdbh/emacs-dev:v2.01
  #+end_src
* Cleanup
  #+BEGIN_SRC sh
    # stop and remove container
    docker stop dev
    docker rm dev

    # remove images
    docker rmi emacs-dev
  #+END_SRC
